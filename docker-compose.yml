version: "3.9"

services:
  shop:
    build:
      context: ./apps/shop
    environment:
      - PORT=8000
      - SESSION_SECRET=dev-secret
      - DATABASE_PATH=/data/shop.db
      - ATTACKER_URL=http://localhost:9000
    ports:
      - "8000:8000"
    volumes:
      - ./apps/shop:/app
      - /app/node_modules
      - ./db_data:/data
    command: ["node", "src/server.js"]

  attacker:
    build:
      context: ./apps/attacker
    environment:
      - PORT=9000
      - TARGET_BASE=http://localhost:8000
    ports:
      - "9000:9000"
    volumes:
      - ./apps/attacker:/app
      - /app/node_modules
    depends_on:
      - shop
    command: ["node", "server.js"]
